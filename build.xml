<?xml version="1.0" encoding="UTF-8"?>
<!-- PHing build -->
<project name="AC_Interface" default="build" basedir=".">

	<property name="project.name" value="${phing.project.name}" />
	<property name="basedir" value="${project.basedir}" />
	<property name="build" value="${basedir}/../build" />
	<property file="build.properties" />
	<property name="build.tag" value="${DSTAMP}${TSTAMP}" />
	<property name="dist" value="${basedir}/../dist" />
	<property name="dist.name" value="${project.name}-${project.version}" />		
	<!-- Pattern to exclude source files from distribution -->
	<patternset id="dist.exc">
    	<exclude name="**/.*/**" /><!--hidden files-->
		<exclude name="build*" /><!--build file/s-->
		<exclude name="**/tests/**" /><!--tests-->
		<exclude name="**/database/**" /><!--db schema-->
	</patternset>	

	<!-- Checkout latest version from SVN -->
	<target name="checkout">
		<svnupdate svnpath="svn" nocache="true" todir="${basedir}" />
		<svnlastrevision svnpath="/usr/bin/svn" workingcopy="${basedir}"
			propertyname="revision" />		
	</target>

	<!-- Clean and set up build/dist directories -->
	<target name="clean">
	    <delete dir="${build}" includeemptydirs="true"/>
	    <delete dir="${dist}" includeemptydirs="true"/>	    
		
		<mkdir dir="${dist}" />
		<mkdir dir="${build}/logs" />
		<mkdir dir="${build}/api" />
		<mkdir dir="${build}/coverage" />
		<mkdir dir="${build}/graph" />
	</target>

	<!-- Generate documentation -->
	<target name="phpdoc">
		<exec dir="${basedir}"
			command="phpdoc -ct type -ue on -t ${build}/api
                          -tb /usr/share/php/data/phpUnderControl/data/phpdoc -o HTML:Phpuc:phpuc
                          -d ${basedir}" />
	</target>

	<!-- Execute Code Sniffer -->
	<target name="phpcs">
		<exec dir="${basedir}"
			command="phpcs --report=checkstyle --standard=PEAR ${basedir}
                   > ${build}/logs/checkstyle.xml"
			escape="false" />
	</target>

	<!-- Execute pdepend and store reports -->
	<target name="pdepend">
		<exec dir="${basedir}"
			command="pdepend --jdepend-xml=${build}/logs/jdepend.xml 
                           --summary-xml=${build}/logs/jdepend-summary.xml 
                           --overview-pyramid=${build}/graph/pyramid.svg 
                           --jdepend-chart=${build}/graph/jdepend.svg 
                           --bad-documentation 
                           ${basedir}" />
	</target>
		
	<!-- Check PHP syntax -->
	<target name="phplint">
		<phplint haltonfailure="true">
			<fileset dir="${basedir}">
				<include name="**/*.php" />
			</fileset>
		</phplint>
	</target>

	<target name="build"
		depends="clean,checkout,phplint,phpcs,phpdoc,pdepend" />

</project>